version: 2.1
executors:
  golang:
    docker:
      - image: circleci/golang:1.13
    working_directory: ~/repos/rosetta
jobs:
  build-bls-zexe:
    docker:
      - image: circleci/rust:1.41.0
    working_directory: ~/repos/rosetta
    steps:
      - checkout
      - run:
          name: Setup Rust language
          command: |
            rustup install 1.41.0
            rustup default 1.41.0
      - run:
          name: Compile bls-zexe
          command: |
            export PATH=$PATH:~/.cargo/bin
            make bls-zexe
  build-rosetta:
    executor: golang
    steps:
      - attach_workspace:
          at: ~/repos
      - run: make rc0-env
      - run: make rosetta
  unit-tests:
    executor: golang
    steps:
      - attach_workspace:
          at: ~/repos
      - run: make test

workflows:
  version: 2
  build:
    jobs:
      - build-bls-zexe
      - build-rosetta:
          requires:
            - build-bls-zexe
      - unit-tests:
          requires:
            - build-bls-zexe
